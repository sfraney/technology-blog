---
title: "Converting Arch Linux Router Backup to Image (for VM)"
description: ""
summary: ""
date: 2021-06-01T23:33:00+07:00
draft: true
time: ""
tags: []
featured_image: 
---

From (https://serverfault.com/a/247933)[https://serverfault.com/a/247933 "ServerFault Answer"]

From directory containing the 'latest' backup
1. Create empty image: `dd if=/dev/null of=archrouter.img bs=4M seek=2048`
1. Create filesystem on the image: `mkfs.ext4 -F archrouter.img`
1. Mount the image: `sudo mount -t ext4 -o loop archrouter.img /mnt/tmp`
1. Copy backup to mounted image: `sudo rsync -azvH latest/ /mnt/tmp/`
1. Unmount: `sudo umount /mnt/tmp`
1. Fix permissions (heavy handed, will probably have to tweak some when VM is live
   - `sudo chown -R root:root /mnt/tmp/`
   - `sudo chown -R 1000:1000 /mnt/tmp/home/admin` (since `admin`'s group is 1000)
1. Convert to qcow2 (to avoid taking up more disk space than necessary; this could be skipped and just create the VM from the .img): **How to do this?**

